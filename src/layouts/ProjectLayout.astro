---
import MainLayoutFooterless from "../layouts/MainLayoutFooterless.astro";
import ProjectInfo from "../components/project/ProjectInfo.vue";
import ProjectGallery from "../components/project/ProjectGallery.vue";
import { Image } from "astro:assets";
import ButtonImage from "../components/ButtonImage.vue";
import ProjectNavigation from "../components/project/ProjectNavigation.vue";
import { getSurroundingProjects, queryProject } from "../utils/utils.ts";
import { isVerticalImage, getProjectImages } from "../utils/images";
import { ProjectType } from "../utils/enum";
import { queryWebProjects } from "../utils/utils.ts";

export interface Props {
  project: string;
  type: ProjectType;
}
const { project, type } = Astro.props;
const path = `/projects/${type.toLowerCase()}/`;

const projects = await queryWebProjects();
const { name, tech, description, homepage } =
  (await queryProject(project)) ?? {};

const total = projects.length;
const index = projects.findIndex((p) => p.name === name);
const { prev, next } = getSurroundingProjects(index, projects);

const images = getProjectImages(type, project);
---

<MainLayoutFooterless>
  <div class="project">
    <ProjectInfo
      name={name}
      url={homepage}
      tech={tech}
      description={description}
    >
      <ProjectNavigation
        index={index}
        prev={prev}
        next={next}
        total={total}
        path={path}
      />
    </ProjectInfo>
    <ProjectGallery type={type} client:only>
      {
        images.map((image, index) =>
          image.then((img) => (
            <ButtonImage>
              <Image
                src={image}
                alt={`${name} gallery picture ${index + 1}`}
                loading={"eager"}
                class:list={[{ mobile: isVerticalImage(img) }]}
              />
            </ButtonImage>
          )),
        )
      }
    </ProjectGallery>
    <ProjectNavigation
      index={index}
      prev={prev}
      next={next}
      total={total}
      path={path}
      mobile={true}
    />
  </div>
</MainLayoutFooterless>

<style scoped>
  .project {
    display: grid;
    grid-template-columns: repeat(10, minmax(0px, 1fr));
    gap: 0.5rem;
    width: 100%;
  }

  img {
    width: 100%;
    height: auto;
    object-fit: cover;
  }

  img.mobile {
    width: auto;
    height: 100%;
    max-height: 85vh;
  }

  @media (max-width: 1280px) {
    .project {
      display: flex;
      flex-flow: column;
      padding: 0 0.5rem;
    }
  }
</style>
